/**
 * SPDX-FileCopyrightText: 2022-2024 Zeal 8-bit Computer <contact@zeal8bit.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */

function FontTable() {
    const CHARACTER_SIZE   = 12; // in bytes
    const CHARACTER_HEIGHT = 12;
    const CHARACTER_WIDTH  = 8;

    /* Each character in the font table is 12 byte big, each of these byte is a bitmap */
    var fontTable = new Array(256);
    fontTable[0] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[1] = [0,0,0,96,112,120,124,120,112,96,0,0];
    fontTable[2] = [0,0,0,96,80,72,68,72,80,96,0,0];
    fontTable[3] = [0,0,0,6,14,30,62,30,14,6,0,0];
    fontTable[4] = [0,0,0,6,10,18,34,18,10,6,0,0];
    fontTable[5] = [0,16,40,40,40,110,161,161,129,66,60,0];
    fontTable[6] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[7] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[8] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[9] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[10] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[11] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[12] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[13] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[14] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[15] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[16] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[17] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[18] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[19] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[20] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[21] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[22] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[23] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[24] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[25] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[26] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[27] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[28] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[29] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[30] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[31] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[32] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[33] = [0,0,16,16,16,16,16,0,16,16,0,0];
    fontTable[34] = [0,0,40,40,40,0,0,0,0,0,0,0];
    fontTable[35] = [0,0,40,40,124,40,40,124,40,40,0,0];
    fontTable[36] = [0,0,16,56,84,80,56,20,84,56,16,0];
    fontTable[37] = [0,0,36,84,40,8,16,20,42,36,0,0];
    fontTable[38] = [0,0,16,40,40,16,50,74,68,58,0,0];
    fontTable[39] = [0,0,24,16,32,0,0,0,0,0,0,0];
    fontTable[40] = [0,8,16,16,32,32,32,32,16,16,8,0];
    fontTable[41] = [0,32,16,16,8,8,8,8,16,16,32,0];
    fontTable[42] = [0,0,0,0,40,16,124,16,40,0,0,0];
    fontTable[43] = [0,0,0,0,16,16,124,16,16,0,0,0];
    fontTable[44] = [0,0,0,0,0,0,0,0,16,16,32,0];
    fontTable[45] = [0,0,0,0,0,0,124,0,0,0,0,0];
    fontTable[46] = [0,0,0,0,0,0,0,0,16,16,0,0];
    fontTable[47] = [0,0,4,4,8,8,16,16,32,32,0,0];
    fontTable[48] = [0,0,56,68,76,84,100,68,68,56,0,0];
    fontTable[49] = [0,0,8,24,40,8,8,8,8,8,0,0];
    fontTable[50] = [0,0,56,68,68,8,16,32,64,124,0,0];
    fontTable[51] = [0,0,56,68,4,24,4,4,68,56,0,0];
    fontTable[52] = [0,0,8,24,24,40,40,124,8,8,0,0];
    fontTable[53] = [0,0,124,64,64,120,4,4,4,120,0,0];
    fontTable[54] = [0,0,56,64,64,120,68,68,68,56,0,0];
    fontTable[55] = [0,0,124,4,8,8,16,16,32,32,0,0];
    fontTable[56] = [0,0,56,68,68,56,68,68,68,56,0,0];
    fontTable[57] = [0,0,56,68,68,68,60,4,4,56,0,0];
    fontTable[58] = [0,0,0,0,16,16,0,0,16,16,0,0];
    fontTable[59] = [0,0,0,0,16,16,0,0,16,16,32,0];
    fontTable[60] = [0,0,0,0,8,48,64,48,8,0,0,0];
    fontTable[61] = [0,0,0,0,0,124,0,124,0,0,0,0];
    fontTable[62] = [0,0,0,0,32,24,4,24,32,0,0,0];
    fontTable[63] = [0,0,56,68,68,8,16,0,16,16,0,0];
    fontTable[64] = [0,0,56,68,92,84,84,76,64,60,0,0];
    fontTable[65] = [0,0,16,16,40,40,56,68,68,68,0,0];
    fontTable[66] = [0,0,120,68,68,120,68,68,68,120,0,0];
    fontTable[67] = [0,0,56,68,64,64,64,64,68,56,0,0];
    fontTable[68] = [0,0,120,68,68,68,68,68,68,120,0,0];
    fontTable[69] = [0,0,124,64,64,120,64,64,64,124,0,0];
    fontTable[70] = [0,0,124,64,64,120,64,64,64,64,0,0];
    fontTable[71] = [0,0,56,68,64,76,68,68,68,56,0,0];
    fontTable[72] = [0,0,68,68,68,124,68,68,68,68,0,0];
    fontTable[73] = [0,0,56,16,16,16,16,16,16,56,0,0];
    fontTable[74] = [0,0,60,4,4,4,4,4,4,56,0,0];
    fontTable[75] = [0,0,68,72,80,96,96,80,72,68,0,0];
    fontTable[76] = [0,0,32,32,32,32,32,32,32,60,0,0];
    fontTable[77] = [0,0,68,124,68,68,68,68,68,68,0,0];
    fontTable[78] = [0,0,68,100,100,84,84,76,76,68,0,0];
    fontTable[79] = [0,0,56,68,68,68,68,68,68,56,0,0];
    fontTable[80] = [0,0,120,68,68,120,64,64,64,64,0,0];
    fontTable[81] = [0,0,56,68,68,68,68,68,68,56,12,0];
    fontTable[82] = [0,0,120,68,68,120,72,72,68,68,0,0];
    fontTable[83] = [0,0,56,68,64,56,4,4,68,56,0,0];
    fontTable[84] = [0,0,124,16,16,16,16,16,16,16,0,0];
    fontTable[85] = [0,0,68,68,68,68,68,68,68,60,0,0];
    fontTable[86] = [0,0,68,68,68,40,40,40,16,16,0,0];
    fontTable[87] = [0,0,68,68,68,68,68,68,124,68,0,0];
    fontTable[88] = [0,0,68,68,40,16,16,40,68,68,0,0];
    fontTable[89] = [0,0,68,68,40,40,16,16,16,16,0,0];
    fontTable[90] = [0,0,124,4,8,16,16,32,64,124,0,0];
    fontTable[91] = [0,56,32,32,32,32,32,32,32,32,56,0];
    fontTable[92] = [0,0,64,64,32,32,16,16,8,8,0,0];
    fontTable[93] = [0,56,8,8,8,8,8,8,8,8,56,0];
    fontTable[94] = [0,0,16,40,68,0,0,0,0,0,0,0];
    fontTable[95] = [0,0,0,0,0,0,0,0,0,0,124,0];
    fontTable[96] = [0,0,48,16,8,0,0,0,0,0,0,0];
    fontTable[97] = [0,0,0,0,56,4,60,68,68,60,0,0];
    fontTable[98] = [0,0,64,64,120,68,68,68,68,120,0,0];
    fontTable[99] = [0,0,0,0,56,68,64,64,68,56,0,0];
    fontTable[100] = [0,4,4,4,60,68,68,68,68,60,0,0];
    fontTable[101] = [0,0,0,0,56,68,124,64,68,56,0,0];
    fontTable[102] = [0,0,28,32,120,32,32,32,32,32,0,0];
    fontTable[103] = [0,0,0,0,60,68,68,68,68,60,4,56];
    fontTable[104] = [0,0,64,64,92,100,68,68,68,68,0,0];
    fontTable[105] = [0,16,16,0,48,16,16,16,16,16,0,0];
    fontTable[106] = [0,8,8,0,24,8,8,8,8,8,8,48];
    fontTable[107] = [0,64,64,64,68,72,112,112,72,68,0,0];
    fontTable[108] = [0,0,48,16,16,16,16,16,16,16,0,0];
    fontTable[109] = [0,0,0,0,124,84,84,84,84,84,0,0];
    fontTable[110] = [0,0,0,0,92,100,68,68,68,68,0,0];
    fontTable[111] = [0,0,0,0,56,68,68,68,68,56,0,0];
    fontTable[112] = [0,0,0,0,120,68,68,68,68,120,64,64];
    fontTable[113] = [0,0,0,0,60,68,68,68,68,60,4,4];
    fontTable[114] = [0,0,0,0,92,96,64,64,64,64,0,0];
    fontTable[115] = [0,0,0,0,56,68,56,4,68,56,0,0];
    fontTable[116] = [0,0,32,32,120,32,32,32,32,24,0,0];
    fontTable[117] = [0,0,0,0,68,68,68,68,68,60,0,0];
    fontTable[118] = [0,0,0,0,68,68,40,40,16,16,0,0];
    fontTable[119] = [0,0,0,0,68,68,68,68,124,68,0,0];
    fontTable[120] = [0,0,0,0,68,40,16,16,40,68,0,0];
    fontTable[121] = [0,0,0,0,68,68,68,68,68,60,4,56];
    fontTable[122] = [0,0,0,0,124,8,16,32,64,124,0,0];
    fontTable[123] = [0,24,32,32,32,192,192,32,32,32,24,0];
    fontTable[124] = [0,0,16,16,16,16,16,16,16,16,0,0];
    fontTable[125] = [0,48,8,8,8,6,6,8,8,8,48,0];
    fontTable[126] = [0,0,0,0,50,90,76,0,0,0,0,0];
    fontTable[127] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[128] = [16,16,16,16,16,16,16,16,16,16,16,16];
    fontTable[129] = [16,16,16,16,16,16,31,16,16,16,16,16];
    fontTable[130] = [16,16,16,16,16,16,240,16,16,16,16,16];
    fontTable[131] = [16,16,16,16,16,16,255,16,16,16,16,16];
    fontTable[132] = [0,0,0,0,0,0,255,0,0,0,0,0];
    fontTable[133] = [16,16,16,16,16,16,31,0,0,0,0,0];
    fontTable[134] = [16,16,16,16,16,16,240,0,0,0,0,0];
    fontTable[135] = [16,16,16,16,16,16,255,0,0,0,0,0];
    fontTable[136] = [0,0,0,0,0,0,16,16,16,16,16,16];
    fontTable[137] = [0,0,0,0,0,0,31,16,16,16,16,16];
    fontTable[138] = [0,0,0,0,0,0,240,16,16,16,16,16];
    fontTable[139] = [0,0,0,0,0,0,255,16,16,16,16,16];
    fontTable[140] = [16,16,16,16,16,31,16,31,16,16,16,16];
    fontTable[141] = [16,16,16,16,16,240,16,240,16,16,16,16];
    fontTable[142] = [16,16,16,16,16,255,16,255,16,16,16,16];
    fontTable[143] = [16,16,16,16,16,31,16,31,0,0,0,0];
    fontTable[144] = [40,40,40,40,40,40,40,40,40,40,40,40];
    fontTable[145] = [40,40,40,40,40,47,32,47,40,40,40,40];
    fontTable[146] = [40,40,40,40,40,232,8,232,40,40,40,40];
    fontTable[147] = [40,40,40,40,40,239,0,239,40,40,40,40];
    fontTable[148] = [0,0,0,0,0,255,0,255,0,0,0,0];
    fontTable[149] = [40,40,40,40,40,47,32,63,0,0,0,0];
    fontTable[150] = [40,40,40,40,40,232,8,248,0,0,0,0];
    fontTable[151] = [40,40,40,40,40,239,0,255,0,0,0,0];
    fontTable[152] = [0,0,0,0,0,0,40,40,40,40,40,40];
    fontTable[153] = [0,0,0,0,0,63,32,47,40,40,40,40];
    fontTable[154] = [0,0,0,0,0,248,8,232,40,40,40,40];
    fontTable[155] = [0,0,0,0,0,255,0,239,40,40,40,40];
    fontTable[156] = [40,40,40,40,40,40,255,0,0,0,0,0];
    fontTable[157] = [0,0,0,0,0,0,255,40,40,40,40,40];
    fontTable[158] = [0,0,0,0,0,240,16,240,16,16,16,16];
    fontTable[159] = [16,16,16,16,16,240,16,240,0,0,0,0];
    fontTable[160] = [0,0,0,0,0,0,0,0,0,0,0,0];
    fontTable[161] = [240,240,240,240,240,240,0,0,0,0,0,0];
    fontTable[162] = [15,15,15,15,15,15,0,0,0,0,0,0];
    fontTable[163] = [255,255,255,255,255,255,0,0,0,0,0,0];
    fontTable[164] = [0,0,0,0,0,0,240,240,240,240,240,240];
    fontTable[165] = [240,240,240,240,240,240,240,240,240,240,240,240];
    fontTable[166] = [15,15,15,15,15,15,240,240,240,240,240,240];
    fontTable[167] = [255,255,255,255,255,255,240,240,240,240,240,240];
    fontTable[168] = [0,0,0,0,0,0,15,15,15,15,15,15];
    fontTable[169] = [240,240,240,240,240,240,15,15,15,15,15,15];
    fontTable[170] = [15,15,15,15,15,15,15,15,15,15,15,15];
    fontTable[171] = [255,255,255,255,255,255,15,15,15,15,15,15];
    fontTable[172] = [0,0,0,0,0,0,255,255,255,255,255,255];
    fontTable[173] = [240,240,240,240,240,240,255,255,255,255,255,255];
    fontTable[174] = [15,15,15,15,15,15,255,255,255,255,255,255];
    fontTable[175] = [0,0,124,0,0,0,0,0,0,0,0,0];
    fontTable[176] = [170,85,170,85,170,85,170,85,170,85,170,85];
    fontTable[177] = [0,0,0,0,16,16,124,16,16,124,0,0];
    fontTable[178] = [0,0,24,36,8,16,60,0,0,0,0,0];
    fontTable[179] = [0,0,56,4,24,4,56,0,0,0,0,0];
    fontTable[180] = [0,0,8,16,0,0,0,0,0,0,0,0];
    fontTable[181] = [0,0,0,0,68,68,68,68,100,92,66,64];
    fontTable[182] = [0,0,60,116,116,116,52,20,20,20,0,0];
    fontTable[183] = [0,0,0,0,0,0,16,16,0,0,0,0];
    fontTable[184] = [0,0,0,0,0,0,0,0,0,0,16,32];
    fontTable[185] = [0,0,8,24,8,8,8,0,0,0,0,0];
    fontTable[186] = [0,0,24,36,36,24,0,60,0,0,0,0];
    fontTable[187] = [0,0,0,0,0,72,36,36,72,0,0,0];
    fontTable[188] = [0,0,32,96,34,36,42,22,42,14,2,0];
    fontTable[189] = [0,0,32,96,34,36,44,26,36,8,14,0];
    fontTable[190] = [0,0,96,16,98,20,106,22,42,14,2,0];
    fontTable[191] = [0,0,16,16,0,16,8,68,68,56,0,0];
    fontTable[192] = [32,16,16,16,40,40,56,68,68,68,0,0];
    fontTable[193] = [8,16,16,16,40,40,56,68,68,68,0,0];
    fontTable[194] = [16,40,16,16,40,40,56,68,68,68,0,0];
    fontTable[195] = [20,40,16,16,40,40,56,68,68,68,0,0];
    fontTable[196] = [40,0,16,16,40,40,56,68,68,68,0,0];
    fontTable[197] = [16,40,16,16,40,40,56,68,68,68,0,0];
    fontTable[198] = [0,0,14,24,24,46,40,56,72,78,0,0];
    fontTable[199] = [0,0,56,68,64,64,64,64,68,56,16,32];
    fontTable[200] = [32,16,124,64,64,120,64,64,64,124,0,0];
    fontTable[201] = [8,16,124,64,64,120,64,64,64,124,0,0];
    fontTable[202] = [16,40,124,64,64,120,64,64,64,124,0,0];
    fontTable[203] = [40,0,124,64,64,120,64,64,64,124,0,0];
    fontTable[204] = [32,16,56,16,16,16,16,16,16,56,0,0];
    fontTable[205] = [8,16,56,16,16,16,16,16,16,56,0,0];
    fontTable[206] = [16,40,56,16,16,16,16,16,16,56,0,0];
    fontTable[207] = [40,0,56,16,16,16,16,16,16,56,0,0];
    fontTable[208] = [0,0,120,68,68,68,228,68,68,120,0,0];
    fontTable[209] = [20,40,68,100,100,84,84,76,76,68,0,0];
    fontTable[210] = [32,16,56,68,68,68,68,68,68,56,0,0];
    fontTable[211] = [8,16,56,68,68,68,68,68,68,56,0,0];
    fontTable[212] = [16,40,56,68,68,68,68,68,68,56,0,0];
    fontTable[213] = [20,40,56,68,68,68,68,68,68,56,0,0];
    fontTable[214] = [40,0,56,68,68,68,68,68,68,56,0,0];
    fontTable[215] = [0,0,0,0,0,40,16,40,0,0,0,0];
    fontTable[216] = [0,0,58,68,76,84,100,100,68,184,0,0];
    fontTable[217] = [32,16,68,68,68,68,68,68,68,60,0,0];
    fontTable[218] = [8,16,68,68,68,68,68,68,68,60,0,0];
    fontTable[219] = [16,40,68,68,68,68,68,68,68,60,0,0];
    fontTable[220] = [40,0,68,68,68,68,68,68,68,60,0,0];
    fontTable[221] = [8,16,68,68,40,40,16,16,16,16,0,0];
    fontTable[222] = [0,0,32,32,56,36,36,36,56,32,32,0];
    fontTable[223] = [0,0,48,72,72,80,88,68,68,72,0,0];
    fontTable[224] = [0,32,16,0,56,4,60,68,68,60,0,0];
    fontTable[225] = [0,8,16,0,56,4,60,68,68,60,0,0];
    fontTable[226] = [0,16,40,0,56,4,60,68,68,60,0,0];
    fontTable[227] = [0,20,40,0,56,4,60,68,68,60,0,0];
    fontTable[228] = [0,40,40,0,56,4,60,68,68,60,0,0];
    fontTable[229] = [16,40,16,0,56,4,60,68,68,60,0,0];
    fontTable[230] = [0,0,0,0,108,18,126,144,144,108,0,0];
    fontTable[231] = [0,0,0,0,56,68,64,64,68,56,16,32];
    fontTable[232] = [0,32,16,0,56,68,124,64,68,56,0,0];
    fontTable[233] = [0,8,16,0,56,68,124,64,68,56,0,0];
    fontTable[234] = [0,16,40,0,56,68,124,64,68,56,0,0];
    fontTable[235] = [0,40,40,0,56,68,124,64,68,56,0,0];
    fontTable[236] = [0,32,16,0,48,16,16,16,16,16,0,0];
    fontTable[237] = [0,8,16,0,48,16,16,16,16,16,0,0];
    fontTable[238] = [0,16,40,0,48,16,16,16,16,16,0,0];
    fontTable[239] = [0,40,40,0,48,16,16,16,16,16,0,0];
    fontTable[240] = [0,80,32,80,56,68,68,68,68,56,0,0];
    fontTable[241] = [0,20,40,0,92,100,68,68,68,68,0,0];
    fontTable[242] = [0,32,16,0,56,68,68,68,68,56,0,0];
    fontTable[243] = [0,8,16,0,56,68,68,68,68,56,0,0];
    fontTable[244] = [0,16,40,0,56,68,68,68,68,56,0,0];
    fontTable[245] = [0,20,40,0,56,68,68,68,68,56,0,0];
    fontTable[246] = [0,40,40,0,56,68,68,68,68,56,0,0];
    fontTable[247] = [0,0,0,16,16,0,124,0,16,16,0,0];
    fontTable[248] = [0,0,0,2,60,76,84,100,68,184,0,0];
    fontTable[249] = [0,32,16,0,68,68,68,68,68,60,0,0];
    fontTable[250] = [0,8,16,0,68,68,68,68,68,60,0,0];
    fontTable[251] = [0,16,40,0,68,68,68,68,68,60,0,0];
    fontTable[252] = [0,40,40,0,68,68,68,68,68,60,0,0];
    fontTable[253] = [0,8,16,0,68,68,68,68,68,60,4,56];
    fontTable[254] = [0,0,64,88,100,68,68,68,100,88,64,0];
    fontTable[255] = [0,40,40,0,68,68,68,68,68,60,4,56];

    /* ImageData table for each character */
    const imageTable = new Array(256);
    for (var i = 0; i < imageTable.length; i++) {
        imageTable[i] = new ImageData(CHARACTER_WIDTH, CHARACTER_HEIGHT);
    }


    /**
     * @brief Public function to get the bitmap of a given character, this shall be used
     *        by the video chip
     */
    this.getCharacterBitmap = function(charCode) {
        console.assert(charCode > 0 && charCode <= 255);
        return fontTable[charCode];
    };

    /**
     * @brief Get an Image out of the bitmap characters.
     *
     * @param bg_color Array of three elements: RGB
     * @param fg_color Array of three elements: RGB
     *
     * @return HTML Canvas for the character `index`
     */
    this.getCharacterImg = function (index, bg_color, fg_color) {
        const img = imageTable[index];
        const data = img.data;
        const bitmaps = fontTable[index];
        var img_pix = 0;

        for (var i = 0; i < bitmaps.length; i++) {
            const line = bitmaps[i];
            for (var bits = 0; bits < CHARACTER_WIDTH; bits++) {
                const bit = (line >> (7 - bits)) & 1;
                const color = (bit == 1) ? fg_color : bg_color;
                data[img_pix++] = color[0];
                data[img_pix++] = color[1];
                data[img_pix++] = color[2];
                data[img_pix++] = 255;
            }
        }

        return img;
    }

    /**
     * @brief Function called when a write (byte) occurs on the memory address where this font
     *        table is mapped.
     *
     * @param address Address relative to this component.
     * @param data    Byte to write at the given offset.
     */
    this.mem_write = function(address, data) {
        console.assert(address < fontTable.length);
        fontTable[address / CHARACTER_SIZE][address % CHARACTER_SIZE] = data;
    };
}
